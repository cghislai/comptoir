<div class="pageContent">

    <form #item-form="form" class="left"
          (ng-submit)="onFormSubmit()"
          enctype="multipart/form-data">

        <div class="table">
            <div>
                <label for="picture">Image</label>

                <div>
                    <img [src]="picture.dataURI"
                         class="itemPicturePreview"
                         *ng-if="picture != null">
                    <input type="file" id="picture" accept="image/*"
                           (change)="onPictureFileSelected($event)">
                </div>
            </div>
            <div>
                <label for="reference">Référence</label>
                <span>
                    <input type="text" id="reference"
                           [placeholder]="itemVariantModel.item.reference"
                           [(ng-model)]="itemVariantModel.variantReference"
                           ng-control="reference" validate-required>
                    <formMessage for="reference"
                                 check-errors=" ['required']"></formMessage>
                </span>
            </div>
            <div>
                <label for="pricing">Type de tarification</label>
                <span>
                    <select id="pricing" required
                            [ng-model]="itemVariantModel.pricing"
                            (change)="onPricingChanged($event)"
                            ng-control="pricing" validate-required>
                        <option *ng-for="#pricing of allPricings"
                                [value]="pricing">
                            {{ getPricingLabel(pricing) }}
                        </option>
                    </select>
                    <formMessage for="pricing"
                                 check-errors="['required']"></formMessage>
                </span>
            </div>
            <div>
                <label for="pricingAmount">Tarif</label>
                <span>
                    <span [hidden]="!pricingAmountRequired">
                        <input class="number" type="number"
                               [value]="itemVariantModel.pricingAmount"
                               (input)="setPricingAmount($event)"
                               [attr.validate-required]="pricingAmountRequired"
                               min="0" step="0.01" id="pricingAmount" size="5"
                               ng-control="pricingAmount">
                        €
                    </span>
                    <div class="totalPreview">
                        <span>
                            Total (TVAC): {{ getItemVariantTotalPrice() | currency:'EUR':true:'.2-2' }}
                        </span>
                    </div>
                    <formMessage for="pricingAmount"
                                 check-errors="['required']"></formMessage>
                </span>
            </div>
        </div>
        <div class="actions">
            <button type="submit"
                    [disabled]="!itemForm.form.valid">Enregistrer</button>
            <a (click)="onCancelClicked()" class="blueLink">Retour</a>
        </div>
    </form>

    <form #attribute-form="form" class="right"
          (ng-submit)="doAddAttribute()">
        <h3>Attributs</h3>

        <table class="dataTable">
            <tbody>
            <tr class="attribute"
                *ng-for="#attribute of itemVariant.attributeValues">
                <td class="definition">
                    {{ attribute.attributeDefinition?.name.get(editLanguage.locale) }}
                </td>
                <td class="value">
                    {{ attribute.value.get(editLanguage.locale) }}
                </td>
                <td class="actions">
                    <a class="actionIcon"
                          (click)="doRemoveAttribute(attribute)">
                        <i class="fi-minus red"></i>
                    </a>
                </td>
            </tr>
            <tr class="attribute unsaved"
                *ng-for="#attribute of unsavedAttributes">
                <td class="definition">
                    {{ attribute.attributeDefinition?.name.get(editLanguage.locale) }}
                </td>
                <td class="value">
                    {{ attribute.value.get(editLanguage.locale) }}
                </td>
                <td class="actions">
                    <a class="actionIcon"
                       (click)="doRemoveAttribute(attribute)">
                        <i class="fi-minus red"></i>
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="form">
            <div class="language">
                <langSelect [display-language]="appLanguage"
                            [selected-language]="editLanguage"
                            (language-changed)="editLanguage = $event"></langSelect>
            </div>
            <div class="attribute">
                <input class="definition"  validate-required
                       ng-control="definition"
                       placeholder="Clef"
                       localized [language]="editLanguage"
                       [locale-texts]="newAttributeValue.attributeDefinition.name"
                       #definition="form">
                <input class="value"  validate-required
                       ng-control="value"
                       placeholder="Valeur"
                       localized [language]="editLanguage"
                       [locale-texts]="newAttributeValue.value"
                       #value="form">
                <button type="submit" [disabled]="!attributeForm.form.valid"
                        class="boxedLink">
                    <i class="fi-plus"></i>
                </button>
            </div>
            <formMessage for="definition" check-errors="['required']"></formMessage>
            <formMessage for="value" check-errors="['required']"></formMessage>

        </div>
    </form>
</div>